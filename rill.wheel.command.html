<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>rill.wheel.command documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Wheel</span> <span class="project-version">0.1.7</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-outline.html"><div class="inner"><span>Conceptual Overview</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rill</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wheel</span></div></div></li><li class="depth-3 branch"><a href="rill.wheel.aggregate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aggregate</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.bare-repository.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bare-repository</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.caching-repository.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching-repository</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.check.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>check</span></div></a></li><li class="depth-3 branch current"><a href="rill.wheel.command.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>command</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.macro-utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macro-utils</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.repository.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repository</span></div></a></li><li class="depth-3 branch"><a href="rill.wheel.testing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>testing</span></div></a></li><li class="depth-3"><a href="rill.wheel.wrap-stream-properties.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wrap-stream-properties</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="rill.wheel.command.html#var-commit.21"><div class="inner"><span>commit!</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-conflict"><div class="inner"><span>conflict</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-conflict.3F"><div class="inner"><span>conflict?</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-defcommand"><div class="inner"><span>defcommand</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-ok"><div class="inner"><span>ok</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-ok.3F"><div class="inner"><span>ok?</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-rejection"><div class="inner"><span>rejection</span></div></a></li><li class="depth-1"><a href="rill.wheel.command.html#var-rejection.3F"><div class="inner"><span>rejection?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">rill.wheel.command</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-commit.21"><h3>commit!</h3><div class="usage"><code>(commit! aggregate repo)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-conflict"><h3>conflict</h3><div class="usage"><code>(conflict aggregate)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-conflict.3F"><h3>conflict?</h3><div class="usage"><code>(conflict? result)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-defcommand"><h3>defcommand</h3><h4 class="type">macro</h4><div class="usage"><code>(defcommand name doc-string? attr-map? [repository properties*] pre-post-map? body)</code></div><div class="doc"><pre class="plaintext">Defines a command as a named function that takes a repo and
properties and returns an aggregate which will be committed, or a
rejection that will be returned.

Returns a `rejection`, an `ok` result or a `conflict`

The metadata of the command MUST contain a :rill.wheel.events key,
which will specify the types of the events that may be generated. As
a convenience, the corresponding event functions are `declare`d
automatically so the `defevent` statements can be written after the
command. This usually reads a bit nicer.

  (defcommand answer-question
    "Try to answer a question"
    {::command/events [::answered-correctly ::answered-incorrectly]}
    [repo question-id user-id answer]
    (let [question (question repo question-id)]
      (if (some-check question answer)
       (answered-correctly question user-id answer)
       (answered-incorrectly question user-id answer))))

</pre></div></div><div class="public anchor" id="var-ok"><h3>ok</h3><div class="usage"><code>(ok aggregate)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-ok.3F"><h3>ok?</h3><div class="usage"><code>(ok? result)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-rejection"><h3>rejection</h3><div class="usage"><code>(rejection aggregate reason)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-rejection.3F"><h3>rejection?</h3><div class="usage"><code>(rejection? result)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>